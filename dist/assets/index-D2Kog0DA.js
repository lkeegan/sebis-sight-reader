var Yt=Object.defineProperty;var Jt=(a,e,r)=>e in a?Yt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[e]=r;var j=(a,e,r)=>Jt(a,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var Tt={};(function a(e,r,o,n){var i=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),l=typeof Path2D=="function"&&typeof DOMMatrix=="function",c=function(){if(!e.OffscreenCanvas)return!1;try{var s=new OffscreenCanvas(1,1),t=s.getContext("2d");t.fillRect(0,0,1,1);var f=s.transferToImageBitmap();t.createPattern(f,"no-repeat")}catch{return!1}return!0}();function v(){}function h(s){var t=r.exports.Promise,f=t!==void 0?t:e.Promise;return typeof f=="function"?new f(s):(s(v,v),null)}var y=function(s,t){return{transform:function(f){if(s)return f;if(t.has(f))return t.get(f);var m=new OffscreenCanvas(f.width,f.height),g=m.getContext("2d");return g.drawImage(f,0,0),t.set(f,m),m},clear:function(){t.clear()}}}(c,new Map),M=function(){var s=Math.floor(16.666666666666668),t,f,m={},g=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(t=function(p){var b=Math.random();return m[b]=requestAnimationFrame(function u(w){g===w||g+s-1<w?(g=w,delete m[b],p()):m[b]=requestAnimationFrame(u)}),b},f=function(p){m[p]&&cancelAnimationFrame(m[p])}):(t=function(p){return setTimeout(p,s)},f=function(p){return clearTimeout(p)}),{frame:t,cancel:f}}(),F=function(){var s,t,f={};function m(g){function p(b,u){g.postMessage({options:b||{},callback:u})}g.init=function(u){var w=u.transferControlToOffscreen();g.postMessage({canvas:w},[w])},g.fire=function(u,w,x){if(t)return p(u,null),t;var E=Math.random().toString(36).slice(2);return t=h(function(T){function B(N){N.data.callback===E&&(delete f[E],g.removeEventListener("message",B),t=null,y.clear(),x(),T())}g.addEventListener("message",B),p(u,E),f[E]=B.bind(null,{data:{callback:E}})}),t},g.reset=function(){g.postMessage({reset:!0});for(var u in f)f[u](),delete f[u]}}return function(){if(s)return s;if(!o&&i){var g=["var CONFETTI, SIZE = {}, module = {};","("+a.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{s=new Worker(URL.createObjectURL(new Blob([g])))}catch(p){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",p),null}m(s)}return s}}(),S={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function C(s,t){return t?t(s):s}function A(s){return s!=null}function _(s,t,f){return C(s&&A(s[t])?s[t]:S[t],f)}function R(s){return s<0?0:Math.floor(s)}function k(s,t){return Math.floor(Math.random()*(t-s))+s}function W(s){return parseInt(s,16)}function Q(s){return s.map(Z)}function Z(s){var t=String(s).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:W(t.substring(0,2)),g:W(t.substring(2,4)),b:W(t.substring(4,6))}}function q(s){var t=_(s,"origin",Object);return t.x=_(t,"x",Number),t.y=_(t,"y",Number),t}function ee(s){s.width=document.documentElement.clientWidth,s.height=document.documentElement.clientHeight}function te(s){var t=s.getBoundingClientRect();s.width=t.width,s.height=t.height}function oe(s){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=s,t}function ie(s,t,f,m,g,p,b,u,w){s.save(),s.translate(t,f),s.rotate(p),s.scale(m,g),s.arc(0,0,1,b,u,w),s.restore()}function le(s){var t=s.angle*(Math.PI/180),f=s.spread*(Math.PI/180);return{x:s.x,y:s.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:s.startVelocity*.5+Math.random()*s.startVelocity,angle2D:-t+(.5*f-Math.random()*f),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:s.color,shape:s.shape,tick:0,totalTicks:s.ticks,decay:s.decay,drift:s.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:s.gravity*3,ovalScalar:.6,scalar:s.scalar,flat:s.flat}}function ce(s,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var f=t.tick++/t.totalTicks,m=t.x+t.random*t.tiltCos,g=t.y+t.random*t.tiltSin,p=t.wobbleX+t.random*t.tiltCos,b=t.wobbleY+t.random*t.tiltSin;if(s.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-f)+")",s.beginPath(),l&&t.shape.type==="path"&&typeof t.shape.path=="string"&&Array.isArray(t.shape.matrix))s.fill(ve(t.shape.path,t.shape.matrix,t.x,t.y,Math.abs(p-m)*.1,Math.abs(b-g)*.1,Math.PI/10*t.wobble));else if(t.shape.type==="bitmap"){var u=Math.PI/10*t.wobble,w=Math.abs(p-m)*.1,x=Math.abs(b-g)*.1,E=t.shape.bitmap.width*t.scalar,T=t.shape.bitmap.height*t.scalar,B=new DOMMatrix([Math.cos(u)*w,Math.sin(u)*w,-Math.sin(u)*x,Math.cos(u)*x,t.x,t.y]);B.multiplySelf(new DOMMatrix(t.shape.matrix));var N=s.createPattern(y.transform(t.shape.bitmap),"no-repeat");N.setTransform(B),s.globalAlpha=1-f,s.fillStyle=N,s.fillRect(t.x-E/2,t.y-T/2,E,T),s.globalAlpha=1}else if(t.shape==="circle")s.ellipse?s.ellipse(t.x,t.y,Math.abs(p-m)*t.ovalScalar,Math.abs(b-g)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):ie(s,t.x,t.y,Math.abs(p-m)*t.ovalScalar,Math.abs(b-g)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if(t.shape==="star")for(var I=Math.PI/2*3,D=4*t.scalar,z=8*t.scalar,O=t.x,V=t.y,J=5,H=Math.PI/J;J--;)O=t.x+Math.cos(I)*z,V=t.y+Math.sin(I)*z,s.lineTo(O,V),I+=H,O=t.x+Math.cos(I)*D,V=t.y+Math.sin(I)*D,s.lineTo(O,V),I+=H;else s.moveTo(Math.floor(t.x),Math.floor(t.y)),s.lineTo(Math.floor(t.wobbleX),Math.floor(g)),s.lineTo(Math.floor(p),Math.floor(b)),s.lineTo(Math.floor(m),Math.floor(t.wobbleY));return s.closePath(),s.fill(),t.tick<t.totalTicks}function fe(s,t,f,m,g){var p=t.slice(),b=s.getContext("2d"),u,w,x=h(function(E){function T(){u=w=null,b.clearRect(0,0,m.width,m.height),y.clear(),g(),E()}function B(){o&&!(m.width===n.width&&m.height===n.height)&&(m.width=s.width=n.width,m.height=s.height=n.height),!m.width&&!m.height&&(f(s),m.width=s.width,m.height=s.height),b.clearRect(0,0,m.width,m.height),p=p.filter(function(N){return ce(b,N)}),p.length?u=M.frame(B):T()}u=M.frame(B),w=T});return{addFettis:function(E){return p=p.concat(E),x},canvas:s,promise:x,reset:function(){u&&M.cancel(u),w&&w()}}}function ne(s,t){var f=!s,m=!!_(t||{},"resize"),g=!1,p=_(t,"disableForReducedMotion",Boolean),b=i&&!!_(t||{},"useWorker"),u=b?F():null,w=f?ee:te,x=s&&u?!!s.__confetti_initialized:!1,E=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,T;function B(I,D,z){for(var O=_(I,"particleCount",R),V=_(I,"angle",Number),J=_(I,"spread",Number),H=_(I,"startVelocity",Number),Ze=_(I,"decay",Number),Ye=_(I,"gravity",Number),Je=_(I,"drift",Number),ze=_(I,"colors",Q),Xe=_(I,"ticks",Number),Oe=_(I,"shapes"),Qe=_(I,"scalar"),et=!!_(I,"flat"),He=q(I),Ge=O,Ee=[],We=s.width*He.x,Ve=s.height*He.y;Ge--;)Ee.push(le({x:We,y:Ve,angle:V,spread:J,startVelocity:H,color:ze[Ge%ze.length],shape:Oe[k(0,Oe.length)],ticks:Xe,decay:Ze,gravity:Ye,drift:Je,scalar:Qe,flat:et}));return T?T.addFettis(Ee):(T=fe(s,Ee,w,D,z),T.promise)}function N(I){var D=p||_(I,"disableForReducedMotion",Boolean),z=_(I,"zIndex",Number);if(D&&E)return h(function(H){H()});f&&T?s=T.canvas:f&&!s&&(s=oe(z),document.body.appendChild(s)),m&&!x&&w(s);var O={width:s.width,height:s.height};u&&!x&&u.init(s),x=!0,u&&(s.__confetti_initialized=!0);function V(){if(u){var H={getBoundingClientRect:function(){if(!f)return s.getBoundingClientRect()}};w(H),u.postMessage({resize:{width:H.width,height:H.height}});return}O.width=O.height=null}function J(){T=null,m&&(g=!1,e.removeEventListener("resize",V)),f&&s&&(document.body.contains(s)&&document.body.removeChild(s),s=null,x=!1)}return m&&!g&&(g=!0,e.addEventListener("resize",V,!1)),u?u.fire(I,O,J):B(I,O,J)}return N.reset=function(){u&&u.reset(),T&&T.reset()},N}var Y;function re(){return Y||(Y=ne(null,{useWorker:!0,resize:!0})),Y}function ve(s,t,f,m,g,p,b){var u=new Path2D(s),w=new Path2D;w.addPath(u,new DOMMatrix(t));var x=new Path2D;return x.addPath(w,new DOMMatrix([Math.cos(b)*g,Math.sin(b)*g,-Math.sin(b)*p,Math.cos(b)*p,f,m])),x}function ge(s){if(!l)throw new Error("path confetti are not supported in this browser");var t,f;typeof s=="string"?t=s:(t=s.path,f=s.matrix);var m=new Path2D(t),g=document.createElement("canvas"),p=g.getContext("2d");if(!f){for(var b=1e3,u=b,w=b,x=0,E=0,T,B,N=0;N<b;N+=2)for(var I=0;I<b;I+=2)p.isPointInPath(m,N,I,"nonzero")&&(u=Math.min(u,N),w=Math.min(w,I),x=Math.max(x,N),E=Math.max(E,I));T=x-u,B=E-w;var D=10,z=Math.min(D/T,D/B);f=[z,0,0,z,-Math.round(T/2+u)*z,-Math.round(B/2+w)*z]}return{type:"path",path:t,matrix:f}}function pe(s){var t,f=1,m="#000000",g='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof s=="string"?t=s:(t=s.text,f="scalar"in s?s.scalar:f,g="fontFamily"in s?s.fontFamily:g,m="color"in s?s.color:m);var p=10*f,b=""+p+"px "+g,u=new OffscreenCanvas(p,p),w=u.getContext("2d");w.font=b;var x=w.measureText(t),E=Math.ceil(x.actualBoundingBoxRight+x.actualBoundingBoxLeft),T=Math.ceil(x.actualBoundingBoxAscent+x.actualBoundingBoxDescent),B=2,N=x.actualBoundingBoxLeft+B,I=x.actualBoundingBoxAscent+B;E+=B+B,T+=B+B,u=new OffscreenCanvas(E,T),w=u.getContext("2d"),w.font=b,w.fillStyle=m,w.fillText(t,N,I);var D=1/f;return{type:"bitmap",bitmap:u.transferToImageBitmap(),matrix:[D,0,0,D,-E*D/2,-T*D/2]}}r.exports=function(){return re().apply(this,arguments)},r.exports.reset=function(){re().reset()},r.exports.create=ne,r.exports.shapeFromPath=ge,r.exports.shapeFromText=pe})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),Tt,!1);const Ct=Tt.exports;Tt.exports.create;function Xt(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function G(a){if(this.size=a|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=a<<1;for(var e=new Array(this.size*2),r=0;r<e.length;r+=2){const v=Math.PI*r/this.size;e[r]=Math.cos(v),e[r+1]=-Math.sin(v)}this.table=e;for(var o=0,n=1;this.size>n;n<<=1)o++;this._width=o%2===0?o-1:o,this._bitrev=new Array(1<<this._width);for(var i=0;i<this._bitrev.length;i++){this._bitrev[i]=0;for(var l=0;l<this._width;l+=2){var c=this._width-l-2;this._bitrev[i]|=(i>>>l&3)<<c}}this._out=null,this._data=null,this._inv=0}var Qt=G;G.prototype.fromComplexArray=function(e,r){for(var o=r||new Array(e.length>>>1),n=0;n<e.length;n+=2)o[n>>>1]=e[n];return o};G.prototype.createComplexArray=function(){const e=new Array(this._csize);for(var r=0;r<e.length;r++)e[r]=0;return e};G.prototype.toComplexArray=function(e,r){for(var o=r||this.createComplexArray(),n=0;n<o.length;n+=2)o[n]=e[n>>>1],o[n+1]=0;return o};G.prototype.completeSpectrum=function(e){for(var r=this._csize,o=r>>>1,n=2;n<o;n+=2)e[r-n]=e[n],e[r-n+1]=-e[n+1]};G.prototype.transform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null};G.prototype.realTransform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null};G.prototype.inverseTransform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=1,this._transform4();for(var o=0;o<e.length;o++)e[o]/=this.size;this._out=null,this._data=null};G.prototype._transform4=function(){var e=this._out,r=this._csize,o=this._width,n=1<<o,i=r/n<<1,l,c,v=this._bitrev;if(i===4)for(l=0,c=0;l<r;l+=i,c++){const A=v[c];this._singleTransform2(l,A,n)}else for(l=0,c=0;l<r;l+=i,c++){const A=v[c];this._singleTransform4(l,A,n)}var h=this._inv?-1:1,y=this.table;for(n>>=2;n>=2;n>>=2){i=r/n<<1;var M=i>>>2;for(l=0;l<r;l+=i)for(var F=l+M,S=l,C=0;S<F;S+=2,C+=n){const A=S,_=A+M,R=_+M,k=R+M,W=e[A],Q=e[A+1],Z=e[_],q=e[_+1],ee=e[R],te=e[R+1],oe=e[k],ie=e[k+1],le=W,ce=Q,fe=y[C],ne=h*y[C+1],Y=Z*fe-q*ne,re=Z*ne+q*fe,ve=y[2*C],ge=h*y[2*C+1],pe=ee*ve-te*ge,s=ee*ge+te*ve,t=y[3*C],f=h*y[3*C+1],m=oe*t-ie*f,g=oe*f+ie*t,p=le+pe,b=ce+s,u=le-pe,w=ce-s,x=Y+m,E=re+g,T=h*(Y-m),B=h*(re-g),N=p+x,I=b+E,D=p-x,z=b-E,O=u+B,V=w-T,J=u-B,H=w+T;e[A]=N,e[A+1]=I,e[_]=O,e[_+1]=V,e[R]=D,e[R+1]=z,e[k]=J,e[k+1]=H}}};G.prototype._singleTransform2=function(e,r,o){const n=this._out,i=this._data,l=i[r],c=i[r+1],v=i[r+o],h=i[r+o+1],y=l+v,M=c+h,F=l-v,S=c-h;n[e]=y,n[e+1]=M,n[e+2]=F,n[e+3]=S};G.prototype._singleTransform4=function(e,r,o){const n=this._out,i=this._data,l=this._inv?-1:1,c=o*2,v=o*3,h=i[r],y=i[r+1],M=i[r+o],F=i[r+o+1],S=i[r+c],C=i[r+c+1],A=i[r+v],_=i[r+v+1],R=h+S,k=y+C,W=h-S,Q=y-C,Z=M+A,q=F+_,ee=l*(M-A),te=l*(F-_),oe=R+Z,ie=k+q,le=W+te,ce=Q-ee,fe=R-Z,ne=k-q,Y=W-te,re=Q+ee;n[e]=oe,n[e+1]=ie,n[e+2]=le,n[e+3]=ce,n[e+4]=fe,n[e+5]=ne,n[e+6]=Y,n[e+7]=re};G.prototype._realTransform4=function(){var e=this._out,r=this._csize,o=this._width,n=1<<o,i=r/n<<1,l,c,v=this._bitrev;if(i===4)for(l=0,c=0;l<r;l+=i,c++){const tt=v[c];this._singleRealTransform2(l,tt>>>1,n>>>1)}else for(l=0,c=0;l<r;l+=i,c++){const tt=v[c];this._singleRealTransform4(l,tt>>>1,n>>>1)}var h=this._inv?-1:1,y=this.table;for(n>>=2;n>=2;n>>=2){i=r/n<<1;var M=i>>>1,F=M>>>1,S=F>>>1;for(l=0;l<r;l+=i)for(var C=0,A=0;C<=S;C+=2,A+=n){var _=l+C,R=_+F,k=R+F,W=k+F,Q=e[_],Z=e[_+1],q=e[R],ee=e[R+1],te=e[k],oe=e[k+1],ie=e[W],le=e[W+1],ce=Q,fe=Z,ne=y[A],Y=h*y[A+1],re=q*ne-ee*Y,ve=q*Y+ee*ne,ge=y[2*A],pe=h*y[2*A+1],s=te*ge-oe*pe,t=te*pe+oe*ge,f=y[3*A],m=h*y[3*A+1],g=ie*f-le*m,p=ie*m+le*f,b=ce+s,u=fe+t,w=ce-s,x=fe-t,E=re+g,T=ve+p,B=h*(re-g),N=h*(ve-p),I=b+E,D=u+T,z=w+N,O=x-B;if(e[_]=I,e[_+1]=D,e[R]=z,e[R+1]=O,C===0){var V=b-E,J=u-T;e[k]=V,e[k+1]=J;continue}if(C!==S){var H=w,Ze=-x,Ye=b,Je=-u,ze=-h*N,Xe=-h*B,Oe=-h*T,Qe=-h*E,et=H+ze,He=Ze+Xe,Ge=Ye+Qe,Ee=Je-Oe,We=l+F-C,Ve=l+M-C;e[We]=et,e[We+1]=He,e[Ve]=Ge,e[Ve+1]=Ee}}}};G.prototype._singleRealTransform2=function(e,r,o){const n=this._out,i=this._data,l=i[r],c=i[r+o],v=l+c,h=l-c;n[e]=v,n[e+1]=0,n[e+2]=h,n[e+3]=0};G.prototype._singleRealTransform4=function(e,r,o){const n=this._out,i=this._data,l=this._inv?-1:1,c=o*2,v=o*3,h=i[r],y=i[r+o],M=i[r+c],F=i[r+v],S=h+M,C=h-M,A=y+F,_=l*(y-F),R=S+A,k=C,W=-_,Q=S-A,Z=C,q=_;n[e]=R,n[e+1]=0,n[e+2]=k,n[e+3]=W,n[e+4]=Q,n[e+5]=0,n[e+6]=Z,n[e+7]=q};const en=Xt(Qt);class Ce{constructor(e,r){j(this,"_inputLength");j(this,"_fft");j(this,"_bufferSupplier");j(this,"_paddedInputBuffer");j(this,"_transformBuffer");j(this,"_inverseBuffer");if(e<1)throw new Error("Input length must be at least one");this._inputLength=e,this._fft=new en(rn(2*e)),this._bufferSupplier=r,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}static forFloat32Array(e){return new Ce(e,r=>new Float32Array(r))}static forFloat64Array(e){return new Ce(e,r=>new Float64Array(r))}static forNumberArray(e){return new Ce(e,r=>Array(r))}get inputLength(){return this._inputLength}autocorrelate(e,r=this._bufferSupplier(e.length)){if(e.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${e.length}`);for(let n=0;n<e.length;n++)this._paddedInputBuffer[n]=e[n];for(let n=e.length;n<this._paddedInputBuffer.length;n++)this._paddedInputBuffer[n]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const o=this._transformBuffer;for(let n=0;n<o.length;n+=2)o[n]=o[n]*o[n]+o[n+1]*o[n+1],o[n+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let n=0;n<e.length;n++)r[n]=this._inverseBuffer[2*n];return r}}function tn(a){const e=[];let r=!1,o=-1/0,n=-1;for(let i=1;i<a.length-1;i++)a[i-1]<=0&&a[i]>0?(r=!0,n=i,o=a[i]):a[i-1]>0&&a[i]<=0?(r=!1,n!==-1&&e.push(n)):r&&a[i]>o&&(o=a[i],n=i);return e}function nn(a,e){const[r,o,n]=[a-1,a,a+1],[i,l,c]=[e[r],e[o],e[n]],v=i/2-l+c/2,h=-(i/2)*(o+n)+l*(r+n)-c/2*(r+o),y=i*o*n/2-l*r*n+c*r*o/2,M=-h/(2*v),F=v*M*M+h*M+y;return[M,F]}class Ne{constructor(e,r){j(this,"_autocorrelator");j(this,"_nsdfBuffer");j(this,"_clarityThreshold",.9);j(this,"_minVolumeAbsolute",0);j(this,"_maxInputAmplitude",1);this._autocorrelator=new Ce(e,r),this._nsdfBuffer=r(e)}static forFloat32Array(e){return new Ne(e,r=>new Float32Array(r))}static forFloat64Array(e){return new Ne(e,r=>new Float64Array(r))}static forNumberArray(e){return new Ne(e,r=>Array(r))}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(e){if(!Number.isFinite(e)||e<=0||e>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=e}set minVolumeAbsolute(e){if(!Number.isFinite(e)||e<0||e>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=e}set minVolumeDecibels(e){if(!Number.isFinite(e)||e>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(e/10)}set maxInputAmplitude(e){if(!Number.isFinite(e)||e<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=e}findPitch(e,r){if(this._belowMinimumVolume(e))return[0,0];this._nsdf(e);const o=tn(this._nsdfBuffer);if(o.length===0)return[0,0];const n=Math.max(...o.map(v=>this._nsdfBuffer[v])),i=o.find(v=>this._nsdfBuffer[v]>=this._clarityThreshold*n),[l,c]=nn(i,this._nsdfBuffer);return[r/l,Math.min(c,1)]}_belowMinimumVolume(e){if(this._minVolumeAbsolute===0)return!1;let r=0;for(let o=0;o<e.length;o++)r+=e[o]**2;return Math.sqrt(r/e.length)<this._minVolumeAbsolute}_nsdf(e){this._autocorrelator.autocorrelate(e,this._nsdfBuffer);let r=2*this._nsdfBuffer[0],o;for(o=0;o<this._nsdfBuffer.length&&r>0;o++)this._nsdfBuffer[o]=2*this._nsdfBuffer[o]/r,r-=e[o]**2+e[e.length-o-1]**2;for(;o<this._nsdfBuffer.length;o++)this._nsdfBuffer[o]=0}}function rn(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a++,a}const Ft={letterIndex:2,octave:4},Ue=["C","D","E","F","G","A","H"],an=["C","C#","D","D#","E","F","F#","G","G#","A","A#","H"],zt=["F","C","G","D","A","E","H"],Ot=["H","E","A","D","G","C","F"],je={natural:{type:"natural",count:0},sharp:{type:"sharp",count:1},sharp2:{type:"sharp",count:2},sharp3:{type:"sharp",count:3},sharp4:{type:"sharp",count:4},sharp5:{type:"sharp",count:5},flat:{type:"flat",count:1},flat2:{type:"flat",count:2},flat3:{type:"flat",count:3},flat4:{type:"flat",count:4},flat5:{type:"flat",count:5}};function sn(a){const e=/^([A-GHB])([#b]?)(-?\d+)$/.exec(a);if(!e)return null;const[,r,o,n]=e;return{letter:r,accidental:o,octave:Number(n)}}function Ht(a,e=Ft){let r=e.letterIndex,o=e.octave;if(a>0)for(let n=0;n<a;n+=1)r+=1,r>=Ue.length&&(r=0,o+=1);else if(a<0)for(let n=0;n<Math.abs(a);n+=1)r-=1,r<0&&(r=Ue.length-1,o-=1);return`${Ue[r]}${o}`}function de(a,e=Ft){const r=sn(a);if(!r)return null;const o=r.letter==="B"?"H":r.letter,n=Ue.indexOf(o);if(n===-1)return null;const i=e.octave*7+e.letterIndex;return r.octave*7+n-i}function on(a){const e=Math.round(69+12*Math.log2(a/440)),r=an[(e%12+12)%12],o=Math.floor(e/12)-1,n=`${r}${o}`,i=`${r.replace("#","").replace("b","")}${o}`;return{name:n,baseName:i,midi:e,accidental:r.includes("#")?"#":r.includes("b")?"b":"",letter:r.replace("#","").replace("b",""),octave:o}}function ye(a){const e=/^([A-GHB])([#b]?)(-?\d+)$/.exec(a);if(!e)return null;const[,r,o,n]=e,i=Number(n),l={C:0,D:2,E:4,F:5,G:7,A:9,H:11,B:11}[r];if(l===void 0)return null;let c=l;return o==="#"&&(c+=1),o==="b"&&(c-=1),(i+1)*12+c}function Gt(a,e){const r=je[e];if(!r||r.count===0)return null;const o=r.type==="sharp"?zt:Ot;return new Set(o.slice(0,r.count)).has(a)?r.type==="sharp"?"#":"b":null}function Wt(a,e){if(!(a!=null&&a.name))return null;const r=/^([A-GHB])([#b]?)(-?\d+)$/.exec(a.name);if(!r)return a.name;const[,o,n,i]=r;if(a.accidental==="natural")return`${o}${i}`;if(n)return a.name;const l=je[e];if(!l||l.count===0)return a.name;const c=l.type==="sharp"?zt:Ot;if(!new Set(c.slice(0,l.count)).has(o))return a.name;const h=l.type==="sharp"?"#":"b";return`${o}${h}${i}`}function ln(a,e,r,o=Ft){if(!a)return a;const n=Number.isFinite(a.staffIndex)?a.staffIndex:de(a.name,o);if(!Number.isFinite(n))return a;const i=ye(Wt(a,e));if(i===null)return a;const l=Ht(n,o),c=/^([A-GH])(\d+)$/.exec(l);if(!c)return a;const[,v,h]=c,y=v==="H"?"B":v,M=[{acc:null,name:l,midi:ye(l)},{acc:"#",name:`${v}#${h}`,midi:ye(`${v}#${h}`)},{acc:"b",name:`${y}b${h}`,midi:ye(`${y}b${h}`)}],F=M.find(_=>_.midi===i)||M[0],S=Gt(v,r);let C=l,A=null;return F.acc===null?A=S?"natural":null:F.acc===S?A=null:(C=F.name,A=F.acc),{...a,name:C,staffIndex:n,accidental:A}}const he=document.getElementById("staff"),d=he.getContext("2d"),Se=document.querySelector(".stage"),Me=document.querySelector(".controls"),nt=document.getElementById("flow-header"),ct=document.getElementById("clef-treble"),ft=document.getElementById("clef-bass"),ut=document.getElementById("sig-sharp"),dt=document.getElementById("sig-sharp-2"),ht=document.getElementById("sig-flat"),mt=document.getElementById("sig-flat-2"),vt=document.getElementById("sig-natural"),gt=document.getElementById("level-1"),pt=document.getElementById("level-2"),bt=document.getElementById("level-3"),Le=document.getElementById("status"),yt=document.getElementById("celebration"),me=document.getElementById("mic-fallback"),Nt=document.getElementById("confetti-canvas"),cn=Nt?Ct.create(Nt,{resize:!0,useWorker:!0}):Ct,Pe=document.getElementById("end-screen"),Fe=document.getElementById("redo-session"),rt=document.getElementById("restart-flow"),at=document.getElementById("session-bar"),St=document.getElementById("progress-label"),Lt=document.getElementById("progress-fill"),st=document.querySelector(".clef-step"),ot=document.querySelector(".signature-toggle"),it=document.querySelector(".level-toggle"),L={left:110,top:130,width:680,lineGap:18},Pt={lineExtension:40},se={treble:{name:"Treble",symbol:"ð„ž",baseNote:{letterIndex:2,octave:4},symbolIndex:2,symbolOffset:.6},bass:{name:"Bass",symbol:"ð„¢",baseNote:{letterIndex:4,octave:2},symbolIndex:6,symbolOffset:-1.55}};let P=se.treble,wt=[],qe=null,ue=null,Te=null,Vt=null,Rt=0;const Be=[],fn=5;let X=null,K=null,be=null,_t=!1,Ie=null,lt=0;const un=25,dn=27.5,hn=4186,Dt=.03,mn=.9,vn=.015;let we=0,Ut=0,_e=!1,xe=null,Re=!1,$="natural",ae=1,De=0;const Mt=10,kt={treble:{sharps:[8,5,9,6,3,7,4],flats:[4,7,3,6,2,5,1]},bass:{sharps:[6,3,7,4,1,5,2],flats:[2,5,1,4,0,3,-1]}};function gn(){const a=[];let e=-6,r=12;if(P===se.treble){const l=de("C4",P.baseNote),c=de("A5",P.baseNote);Number.isFinite(l)&&Number.isFinite(c)&&(e=l,r=c)}else{const l=de("E3",P.baseNote),c=de("C4",P.baseNote);Number.isFinite(l)&&Number.isFinite(c)&&(e=l,r=c)}const o=7,n=ae>=3?e-o:e,i=ae>=3?r+o:r;for(let l=n;l<=i;l+=1){const c=Ht(l,P.baseNote);if(a.push({name:c,staffIndex:l}),ae<2)continue;const v=/^([A-GH])(\d+)$/.exec(c);if(!v)continue;const[,h,y]=v,M=`${h}#${y}`;a.push({name:M,staffIndex:l,accidental:"#"});const S=`${h==="H"?"B":h}b${y}`;a.push({name:S,staffIndex:l,accidental:"b"})}return a}function At(){const a=window.devicePixelRatio||1,{width:e}=he.getBoundingClientRect(),r=Se?Se.getBoundingClientRect().height:420,o=Math.max(420,r-24);he.width=Math.floor(e*a),he.height=Math.floor(o*a),d.setTransform(a,0,0,a,0,0);const n=e,i=o;L.width=Math.min(900,n-180),L.left=Math.max(40,(n-L.width)/2);const l=L.lineGap*4;L.top=Math.max(60,(i-l)/2),$e()}function qt(){X={...wt[Math.floor(Math.random()*wt.length)]},warningShownForNote=!1,$e()}function ke(a){return L.top+L.lineGap*4-a*(L.lineGap/2)}function jt(a){if(Number.isFinite(a.staffIndex))return a.staffIndex;const e=a.baseName||a.name,r=e?de(e,P.baseNote):null;return Number.isFinite(r)?r:0}function $e(){d.clearRect(0,0,he.width,he.height),d.save(),d.scale(1,1),d.fillStyle="#fff7e8",d.fillRect(0,0,he.width,he.height),d.strokeStyle="#1c1b1f",d.lineWidth=2;for(let e=0;e<5;e+=1){const r=L.top+e*L.lineGap;d.beginPath(),d.moveTo(L.left-Pt.lineExtension,r),d.lineTo(L.left+L.width,r),d.stroke()}const a=L.left-Pt.lineExtension+12;if(d.font="96px serif",d.fillStyle="#1c1b1f",d.textBaseline="middle",d.fillText(P.symbol,a,ke(P.symbolIndex)-L.lineGap*P.symbolOffset),d.textBaseline="alphabetic",bn(),X){const e=K&&It(K,X);$t(X,e?"#2fbf71":"#1c1b1f",!1,e?wn():null)}K&&(!X||!It(K,X))&&$t(yn(K),"#f05a5a",!0),d.restore()}function pn(a,e){if(d.strokeStyle="#1c1b1f",d.lineWidth=2,a<0)for(let n=-2;n>=a;n-=2){const i=ke(n);d.beginPath(),d.moveTo(e-18,i),d.lineTo(e+18,i),d.stroke()}if(a>8)for(let n=10;n<=a;n+=2){const i=ke(n);d.beginPath(),d.moveTo(e-18,i),d.lineTo(e+18,i),d.stroke()}}function bn(){const a=je[$];if(!a||a.count===0)return;const e=P===se.treble?kt.treble:kt.bass,r=a.type==="sharp"?e.sharps:e.flats,o=L.left+36;d.fillStyle="#1c1b1f";for(let n=0;n<a.count;n+=1){const i=r[n],l=o+n*22,c=ke(i),v=a.type==="sharp"?12:6;d.font=a.type==="flat"?"57px serif":"42px serif",d.fillText(a.type==="sharp"?"â™¯":"â™­",l,c+v)}}function Ae(a){const e=$;$=a,vt.classList.toggle("active",$==="natural"),vt.setAttribute("aria-pressed",$==="natural"),ut.classList.toggle("active",$==="sharp"),ut.setAttribute("aria-pressed",$==="sharp"),dt.classList.toggle("active",$==="sharp2"),dt.setAttribute("aria-pressed",$==="sharp2"),ht.classList.toggle("active",$==="flat"),ht.setAttribute("aria-pressed",$==="flat"),mt.classList.toggle("active",$==="flat2"),mt.setAttribute("aria-pressed",$==="flat2"),X&&(X=ln(X,e,$,P.baseNote)),$e()}function $t(a,e,r=!1,o=null){const n=L.left+L.width/2+(r?120:0)+(o?o.x:0),i=jt(a),l=ke(i)+(o?o.y:0),c=i>=4;if(pn(i,n),d.save(),d.translate(n,l),d.rotate(-.35),d.fillStyle=e,d.strokeStyle=e,d.lineWidth=2,d.beginPath(),d.ellipse(0,0,12,9,0,0,Math.PI*2),d.fill(),d.restore(),d.strokeStyle=e,d.lineWidth=2,d.beginPath(),c?(d.moveTo(n-10,l+2),d.lineTo(n-10,l+42)):(d.moveTo(n+10,l-2),d.lineTo(n+10,l-42)),d.stroke(),a.accidental){d.font=a.accidental==="b"?"57px serif":"42px serif",d.fillStyle=e;const v=a.accidental==="b"?"â™­":a.accidental==="natural"?"â™®":"#",h=(a.accidental==="b",34),y=a.accidental==="b"?6:14,M=a.accidental==="natural"?y-L.lineGap*.5:y;d.fillText(v,n-h,l+M)}}function yn(a){const e=je[$],r=/^([A-GHB])([#b]?)(-?\d+)$/.exec(a.name);if(!e||!r)return a;const[,o,n,i]=r;let l=a.name,c=jt(a),v=a.accidental||null;if(e.type==="flat"&&n==="#"){const y={"C#":"Db","D#":"Eb","F#":"Gb","G#":"Ab","A#":"Bb"}[`${o}#`];y&&(l=`${y}${i}`,c=de(l,P.baseNote),v="b")}return v||Gt(o,$)&&(v="natural"),{...a,name:l,staffIndex:c,accidental:v}}function It(a,e){const r=Wt(e,$),o=r?ye(r):null,n=Number.isFinite(a==null?void 0:a.midi)?a.midi:a!=null&&a.name?ye(a.name):null;return o===null||n===null?!1:o===n}function wn(){const a=performance.now();if(a>we)return null;const e=(a-(we-700))/700,r=6;return{x:Math.sin(e*Math.PI*6)*r,y:Math.cos(e*Math.PI*5)*r}}function _n(){const a=performance.now();we=a+700,Ut=a+1e3,_e=!0,Re=!0,yt.textContent="Well done!",yt.classList.add("show"),De+=1,Kt(),De>=Mt?(xe&&clearTimeout(xe),xe=setTimeout(()=>{Mn()},1e3)):(xe&&clearTimeout(xe),xe=setTimeout(()=>{_e=!1,we=0,Re=!1,qt()},1e3))}function Mn(){_e=!0,Re=!0,Pe&&Pe.classList.add("show");const a=performance.now()+3e3,e=["#ff3b3b","#1f7bff","#ffffff"];(function r(){cn({particleCount:60,spread:100,startVelocity:90,ticks:70,gravity:.8,scalar:1.15,colors:e,origin:{x:Math.random(),y:0}}),performance.now()<a&&requestAnimationFrame(r)})(),Fe&&(Fe.classList.remove("show"),setTimeout(()=>{Fe.classList.add("show")},3e3))}function Et(){De=0,_e=!1,Re=!1,wt=gn(),Kt(),qt()}function Kt(){!St||!Lt||(St.textContent=`${De} / ${Mt}`,Lt.style.width=`${De/Mt*100}%`)}function U(a){st==null||st.classList.toggle("active",a==="clef"),ot==null||ot.classList.toggle("active",a==="key"),it==null||it.classList.toggle("active",a==="level");const e=a==="session";Se==null||Se.classList.toggle("hidden",!e),at==null||at.classList.toggle("hidden",!e),Le==null||Le.classList.toggle("hidden",!e),me==null||me.classList.toggle("hidden",!e),Me==null||Me.classList.toggle("hidden",e),Me==null||Me.classList.toggle("clef-only",a!=="session"),nt==null||nt.classList.toggle("hidden",e),e&&requestAnimationFrame(At)}async function Zt(){if(!_t)try{me&&me.classList.add("hidden");const a=await navigator.mediaDevices.getUserMedia({audio:!0});qe=new(window.AudioContext||window.webkitAudioContext);const e=qe.createMediaStreamSource(a);ue=qe.createAnalyser(),ue.fftSize=4096,ue.smoothingTimeConstant=.8,e.connect(ue),Te=new Float32Array(ue.fftSize),Vt=Ne.forFloat32Array(ue.fftSize),_t=!0,Le.textContent="Listeningâ€¦",xt()}catch{Le.textContent="Tap to enable microphone",me&&me.classList.remove("hidden")}}function In(){if(!ue)return;ue.getFloatTimeDomainData(Te);let a=0;for(let M=0;M<Te.length;M+=1){const F=Te[M];a+=F*F}const e=Math.sqrt(a/Te.length),[r,o]=Vt.findPitch(Te,qe.sampleRate);if(Rt=o,!r||Rt<mn||r<dn||r>hn||e<vn){K=null,be=null,Ie=null,lt=0,Be.length=0;return}let n=r;be&&(Math.abs(n*2-be)/be<Dt?n*=2:Math.abs(n/2-be)/be<Dt&&(n/=2)),Be.push(n),Be.length>fn&&Be.shift();const i=[...Be].sort((M,F)=>M-F),l=i[Math.floor(i.length/2)];be=l;const c=on(l),v=de(c.name,P.baseNote),h={...c,staffIndex:Number.isFinite(v)?v:void 0},y=performance.now();(!Ie||Ie.midi!==h.midi)&&(Ie=h,lt=y),Ie&&y-lt>=un&&(K=Ie)}function xt(){if(!_t)return;if(Re){$e(),requestAnimationFrame(xt);return}In();const a=performance.now();we&&a>we&&yt.classList.remove("show"),_e&&a>Ut&&(_e=!1,we=0),$e(),!_e&&K&&X&&(It(K,X)?_n():Number.isFinite(K.midi)?K.midi:ye(K.name)),requestAnimationFrame(xt)}function Bt(a){P=a,ct.classList.toggle("active",P===se.treble),ct.setAttribute("aria-pressed",P===se.treble),ft.classList.toggle("active",P===se.bass),ft.setAttribute("aria-pressed",P===se.bass)}function Ke(a){ae=a,gt.classList.toggle("active",ae===1),gt.setAttribute("aria-pressed",ae===1),pt.classList.toggle("active",ae===2),pt.setAttribute("aria-pressed",ae===2),bt.classList.toggle("active",ae===3),bt.setAttribute("aria-pressed",ae===3)}ct.addEventListener("click",()=>{Bt(se.treble),U("key")});ft.addEventListener("click",()=>{Bt(se.bass),U("key")});ut.addEventListener("click",()=>{Ae("sharp"),U("level")});dt.addEventListener("click",()=>{Ae("sharp2"),U("level")});ht.addEventListener("click",()=>{Ae("flat"),U("level")});mt.addEventListener("click",()=>{Ae("flat2"),U("level")});vt.addEventListener("click",()=>{Ae("natural"),U("level")});gt.addEventListener("click",()=>{Ke(1),U("session"),Et()});pt.addEventListener("click",()=>{Ke(2),U("session"),Et()});bt.addEventListener("click",()=>{Ke(3),U("session"),Et()});rt==null||rt.addEventListener("click",()=>{U("clef")});Fe==null||Fe.addEventListener("click",()=>{Pe==null||Pe.classList.remove("show"),U("clef")});me.addEventListener("click",Zt);window.addEventListener("resize",At);At();Bt(se.treble);Ae("natural");Ke(1);U("clef");Zt();
